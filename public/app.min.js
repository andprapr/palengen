let headerFooterLoaded=false;async function loadHeaderFooter(){if(headerFooterLoaded)return;try{const[a,b]=await Promise.all([fetch('./header.html'),fetch('./footer.html')]),c=await Promise.all([a.text(),b.text()]);document.getElementById('headerContainer').innerHTML=c[0],document.getElementById('footerContainer').innerHTML=c[1],headerFooterLoaded=!0,attachHeaderEventListeners(),applySiteConfig()}catch(a){console.error('Error loading header/footer:',a)}}function attachHeaderEventListeners(){const a=document.getElementById('searchInput'),b=document.getElementById('mobileSearchInput');a&&a.addEventListener('keypress',e=>{if('Enter'===e.key&&searchDrama(e.target.value))}),b&&b.addEventListener('keypress',e=>{if('Enter'===e.key&&(searchDrama(e.target.value),document.getElementById('mobileSearchContainer').classList.add('hidden')))}),window.addEventListener('click',function(c){const e=document.querySelector('button[onclick="toggleProviderMenu()"]'),d=document.getElementById('providerDropdown');e&&d&&!e.contains(c.target)&&!d.contains(c.target)&&d.classList.add('hidden')})}const PROVIDERS={netshort:{name:'NetShort',apiBase:'/api/netshort',listPath:'/api/netshort/foryou?page=',searchPath:'/api/netshort/search?query=',color:'bg-gradient-to-br from-red-600 to-red-800',text:'NS',theme:{badge:'bg-red-600/90',tabActive:'bg-red-600 border-red-600 shadow-[0_0_10px_rgba(220,38,38,0.4)]',spinner:'border-t-red-600',hover:'hover:bg-red-600',text:'text-red-500'}},dramabox:{name:'DramaBox',listPath:'/api/dramabox/foryou?page=',searchPath:'/api/dramabox/search?query=',vipPath:'/api/vip',color:'bg-gradient-to-br from-orange-500 to-orange-700',text:'DB',theme:{badge:'bg-orange-600/90',tabActive:'bg-orange-600 border-orange-600 shadow-[0_0_10px_rgba(234,88,12,0.4)]',spinner:'border-t-orange-600',hover:'hover:bg-orange-600',text:'text-orange-500'}}};let activeProviderKey='netshort',currentPage=1,currentTab='all',currentDramaData=null,currentEpisodeIndex=0,idleTimer=null;function toggleMobileSearch(){const a=document.getElementById('mobileSearchContainer');document.getElementById('mobileSearchInput');a.classList.toggle('hidden')}function toggleEpisodeDrawer(){const a=document.getElementById('episodeDrawer');a.classList.toggle('drawer-closed'),a.classList.toggle('drawer-open')}function toggleProviderMenu(){document.getElementById('providerDropdown').classList.toggle('hidden')}function switchProvider(a){const b=PROVIDERS[a];activeProviderKey=a,document.getElementById('currentProviderName').innerText=b.name,document.getElementById('currentProviderIcon').innerText=b.text,document.getElementById('currentProviderIcon').className=`w-6 h-6 rounded-full ${b.color} flex items-center justify-center text-[10px] font-bold text-white overflow-hidden shrink-0`,document.querySelector('#loading div').className=`animate-spin rounded-full h-12 w-12 border-4 border-[#333] ${b.theme.spinner}`,document.getElementById('providerDropdown').classList.add('hidden'),document.getElementById('contentArea').innerHTML='',currentPage=1,document.getElementById('loadingProviderName').innerText=b.name,document.getElementById('pagination').classList.add('hidden'),'dramabox'===a?(loadRecommendations(),document.getElementById('vipTabBtn').classList.remove('hidden')):(document.getElementById('recommendationSection').classList.add('hidden'),document.getElementById('vipTabBtn').classList.add('hidden')),changeTab('all')}function changeTab(a){currentTab=a;const b=PROVIDERS[activeProviderKey].theme;document.querySelectorAll('.tab-btn').forEach(a=>a.className='tab-btn px-4 py-1.5 rounded-full text-sm font-medium transition-all bg-[#1a1a1a] text-gray-400 hover:text-white border border-white/10 hover:border-white/30 whitespace-nowrap');const c=document.querySelector(`button[onclick="changeTab('${a}')"]`);c&&(c.className=`tab-btn active px-6 py-2 rounded-full text-sm font-bold transition-all text-white whitespace-nowrap tracking-wide w-full md:w-auto ${b.tabActive}`),currentPage=1,'vip'===a&&'dramabox'===activeProviderKey?loadVIPContent():fetchDramas(1)}async function loadVIPContent(){setLoading(!0);try{const a=await fetch('/api/vip'),b=await a.json();b.data&&b.data.columnVoList?renderVIPGrid(b.data.columnVoList):(document.getElementById('contentArea').innerHTML='<div class="text-center text-gray-500 mt-20 px-4">Data VIP tidak tersedia</div>',document.getElementById('pagination').classList.add('hidden'))}catch(a){document.getElementById('contentArea').innerHTML='<div class="text-center text-gray-500 mt-20 px-4">Gagal memuat Film VIP</div>',document.getElementById('pagination').classList.add('hidden')}setLoading(!1)}function renderVIPGrid(a){const b=document.getElementById('contentArea');b.innerHTML='',a.forEach((a,c)=>{if(!a.bookList||0===a.bookList.length)return;const d=document.createElement('div');d.className='mb-10';const e=document.createElement('div');e.className='flex items-center gap-3 mb-5 px-1',e.innerHTML=`<h2 class="text-xl font-bold text-white">${a.title||'Film VIP'}</h2><span class="text-xs bg-gradient-to-r from-yellow-500 to-orange-500 text-white px-3 py-1 rounded-full font-bold shadow-lg">üëë VIP</span>`,d.appendChild(e);const f=document.createElement('div');f.className='grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 sm:gap-6',a.bookList.forEach((a,e)=>{const g=a.bookId,h=a.bookName||'Tanpa Judul',i=a.coverWap||'https://placehold.co/300x450?text=No+Cover',j=a.playCount||'N/A',k=a.chapterCount||0,l=a.corner||'',m=(a.tags||[]).slice(0,2).join(', ');let n='';l&&l.includes('Anggota')&&(n=`<span class="bg-gradient-to-r from-purple-600 to-pink-600 text-white text-[9px] font-bold px-1.5 py-0.5 rounded shadow-sm mb-1 block w-fit">üîí ${l}</span>`);const o=`<div class="group cursor-pointer relative bg-[#151515] rounded-xl overflow-hidden shadow-lg hover:shadow-orange-900/20 transition-all duration-300 hover:-translate-y-1 card-anim" style="animation-delay: ${e*30}ms" onclick="openInfo('${g}')"><div class="aspect-[3/4] overflow-hidden relative"><img src="${i}" alt="${h}" loading="lazy" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"><div class="absolute inset-0 bg-gradient-to-t from-black/90 via-transparent to-transparent opacity-80 group-hover:opacity-100"></div><div class="absolute top-2 right-2 flex flex-col items-end">${n}<span class="bg-orange-600/90 text-white text-[9px] font-bold px-1.5 py-0.5 rounded backdrop-blur-sm shadow-sm">üëÅÔ∏è ${j}</span></div></div><div class="p-3"><h3 class="text-xs sm:text-sm font-bold text-gray-200 line-clamp-2 leading-snug group-hover:text-orange-500 transition-colors">${h}</h3>${m?`<p class="text-[10px] text-gray-500 mt-1">${m}</p>`:''}<p class="text-[10px] text-gray-600 mt-0.5">${k} Eps</p></div></div>`;f.innerHTML+=o}),d.appendChild(f),b.appendChild(d)}),b.classList.remove('hidden')}async function loadRecommendations(){const a=document.getElementById('recommendList'),b=document.getElementById('recommendationSection');if('dramabox'!==activeProviderKey)return void b.classList.add('hidden');try{const c=await fetch('/api/recommend?lang=in'),d=await c.json();if(d.success&&d.data&&0<d.data.length){a.innerHTML='',b.classList.remove('hidden'),d.data.forEach(b=>{const c=b.id||b.bookId,d=b.name||b.bookName||'Tanpa Judul',e=b.cover||b.coverWap||'https://placehold.co/300x450?text=No+Cover',f=b.playCount||'Hot',g=b.chapterCount||0,h=`<div class="group relative min-w-[130px] w-[130px] snap-start cursor-pointer transition-transform hover:-translate-y-1" onclick="openInfo('${c}')"><div class="relative rounded-xl overflow-hidden aspect-[3/4] bg-[#1a1a1a] shadow-lg border border-white/5"><div class="absolute top-0 right-0 bg-orange-600 text-[9px] font-bold text-white px-2 py-0.5 rounded-bl-lg z-10 shadow-sm">HOT</div><img src="${e}" class="w-full h-full object-cover opacity-90 group-hover:opacity-100 transition-all duration-300" loading="lazy"><div class="absolute inset-0 bg-gradient-to-t from-black/90 via-transparent to-transparent"></div><div class="absolute bottom-2 left-2 right-2"><div class="text-[10px] text-gray-300 flex items-center gap-1"><svg class="w-3 h-3 text-orange-500" fill="currentColor" viewBox="0 0 20 20"><path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/><path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/></svg>${f}</div></div></div><h3 class="mt-2 text-xs font-bold text-gray-300 line-clamp-2 leading-snug group-hover:text-orange-500 transition-colors">${d}</h3><p class="text-[10px] text-gray-500 mt-0.5">${g} Eps</p></div>`;a.innerHTML+=h});return void 0}b.classList.add('hidden')}catch(c){b.classList.add('hidden')}}async function fetchDramas(a){setLoading(!0);try{const b=PROVIDERS[activeProviderKey],c=await fetch(`${b.listPath}${a}`);if(!c.ok)throw new Error('Gagal mengambil data');const d=await c.json();let e=[];if('dramabox'===activeProviderKey)e=d.data&&d.data.book?d.data.book:Array.isArray(d.data)?d.data:findDramasDeep(d);else e=findDramasDeep(d);e=[...new Map(e.map(a=>[a.shortPlayId||a.id||a.bookId,a])).values()],renderGrid(e),renderPaginationButtons()}catch(a){document.getElementById('contentArea').innerHTML=`<div class="text-center text-gray-500 mt-20 px-4">${a.message}</div>`,document.getElementById('pagination').classList.add('hidden')}setLoading(!1)}async function searchDrama(a){setLoading(!0);try{const b=PROVIDERS[activeProviderKey],c=await fetch(`${b.searchPath}${encodeURIComponent(a)}`),d=await c.json();let e=[];if('dramabox'===activeProviderKey)e=d.data&&d.data.book?d.data.book:findDramasDeep(d);else e=findDramasDeep(d);if(0===e.length){const c=await fetch(`${b.listPath}1`),f=await c.json();let g=[];g='dramabox'===activeProviderKey?f.data&&f.data.book?f.data.book:findDramasDeep(f):findDramasDeep(f),renderGrid(g);const h=document.getElementById('contentArea'),i=document.createElement('div');i.className='col-span-full flex flex-col items-center justify-center py-10 mb-6 text-center animate-fade-in',i.innerHTML=`<div class="bg-white/10 border border-white/10 rounded-2xl p-6 max-w-md backdrop-blur-sm"><div class="text-4xl mb-3">üîç</div><h3 class="text-xl font-bold text-white mb-2">Waduh, "${a}" gak ketemu...</h3><p class="text-gray-300 text-sm">Mungkin salah ketik? <br>Tapi tenang, coba tonton rekomendasi populer ini aja yuk!</p></div>`,h.insertBefore(i,h.firstChild),document.getElementById('pagination').classList.add('hidden')}else renderGrid(e),document.getElementById('pagination').classList.add('hidden')}catch(a){}setLoading(!1)}async function openInfo(a,b=null){setLoading(!0),currentDramaData=null,document.getElementById('infoTitle').innerText='Memuat...',document.getElementById('infoSynopsis').innerText='',document.getElementById('infoCover').src='',document.getElementById('infoEpsBadge').innerText='...',document.getElementById('btnPlayMain').onclick=null,document.getElementById('lastWatchedInfo').classList.add('hidden');try{const c=document.getElementById('infoModal');c.classList.remove('hidden'),setTimeout(()=>c.classList.remove('opacity-0'),10);const d=b||activeProviderKey;let e,f,g,h=[];if('dramabox'===d){const b=await fetch(`/api/detail/${a}/v2?lang=in`),i=await b.json(),j=i.data||i,k=j.drama||j;e=k.bookName||k.name||'Tanpa Judul',f=k.introduction||k.desc||'Tidak ada sinopsis.',g=k.cover||k.coverWap||'',h=j.chapters||[],currentDramaData={shortPlayId:a,shortPlayName:e,shortPlayCover:g,episodes:h,provider:'dramabox'}}else{const b=await fetch(`/api/netshort/allepisode?shortPlayId=${a}`),c=await b.json();const i=c.detail||c;e=i.shortPlayName,g=i.shortPlayCover,f=i.shotIntroduce,h=c.shortPlayEpisodeInfos||[],currentDramaData=c,currentDramaData.provider='netshort'}document.getElementById('infoTitle').innerText=e||'Judul Drama',document.getElementById('infoSynopsis').innerText=f||'Tidak ada sinopsis.',document.getElementById('infoCover').src=g||'';const i=document.getElementById('infoEpsBadge');i.innerText=`${h.length} Episode`;const j=PROVIDERS[d],k=document.getElementById('infoProviderBadge');k.innerText=j.name.toUpperCase(),k.className=`${j.color} text-white text-xs font-bold px-2 py-1 rounded shadow-sm`;const l=getHistory().find(b=>b.id===a),m=document.getElementById('btnPlayMain'),n=document.getElementById('lastWatchedInfo'),o='dramabox'===d?'bg-orange-600 hover:bg-orange-700':'bg-red-600 hover:bg-red-700';m.className=`flex-1 ${o} text-white font-bold py-3 px-4 rounded-xl flex items-center justify-center gap-2 transition transform hover:scale-[1.02] shadow-lg text-sm md:text-base`,l&&l.lastEpIndex<h.length?(m.innerHTML=`Lanjut Episode ${l.lastEpNum}`,m.onclick=()=>startPlayer(l.lastEpIndex),n.classList.remove('hidden'),document.getElementById('lastEpNum').innerText=l.lastEpNum):(m.innerHTML='Tonton Sekarang',m.onclick=()=>startPlayer(0),n.classList.add('hidden'))}catch(a){}setLoading(!1)}function startPlayer(a=0){if(!currentDramaData)return;closeInfoModal();const b='dramabox'===currentDramaData.provider,c=currentDramaData.shortPlayName,d=currentDramaData.shortPlayCover,e=currentDramaData.shortPlayId,f=b?currentDramaData.episodes:currentDramaData.shortPlayEpisodeInfos||currentDramaData.data.shortPlayEpisodeInfos;document.getElementById('playerTitle').innerText=c,document.getElementById('totalEpBadge').innerText=`${f.length} Eps`;const g=document.getElementById('episodeList'),h=document.getElementById('mainVideo'),i=document.getElementById('subStatus');g.innerHTML='';const j=document.getElementById('episodeDrawer');j.classList.add('drawer-closed'),j.classList.remove('drawer-open');const k=b?'bg-orange-600 text-white border-orange-600':'bg-red-600 text-white border-red-600',l=b?'hover:bg-orange-600/20 hover:border-orange-500':'hover:bg-red-600/20 hover:border-red-500';h.onended=()=>{const a=currentEpisodeIndex+1;g.children[a]&&(g.children[a].scrollIntoView({behavior:'smooth',block:'center'}),g.children[a].click())},0<f.length&&f.forEach((a,c)=>{const d=document.createElement('button'),j=b?'number'==typeof a.index?a.index+1:c+1:a.episodeNo||c+1;d.innerText=j,d.className=`py-3 rounded-lg text-sm font-bold transition border border-white/5 bg-[#252525] text-gray-300 ${l}`,d.onclick=async d=>{currentEpisodeIndex=c,Array.from(g.children).forEach(a=>a.className=`py-3 rounded-lg text-sm font-bold transition border border-white/5 bg-[#252525] text-gray-300 ${l}`),d.currentTarget.className=`py-3 rounded-lg text-sm font-bold transition border ${k} shadow-md`,saveToHistory(e,c,j,currentDramaData.provider);if(b){i.innerText='PLAYING',h.innerHTML='';let a=a.url;if(!a)try{const b=await fetch(`/api/stream?bookId=${e}&episode=${j}&lang=in`),c=await b.json();c.success&&(a=c.url)}catch(a){}a?(h.src=a,h.play()):(h.play(),alert('Link video tidak ditemukan.'))}else{const b=a.playVoucher||a.playUrl||a.videoUrl;if(b){h.src=b,h.innerHTML='',i.innerText='SUB: ...';let a=null;if(a.subtitleList&&Array.isArray(a.subtitleList)&&0<a.subtitleList.length)a=a.subtitleList[0].url;else a=a.subtitleUrl||a.srtUrl||a.captionUrl||a.vttUrl||a.subtitles?a.subtitles[0]:null;if(a)try{a.endsWith('.vtt')?(c.createElement('track'),c.kind='captions',c.label='Indonesia',c.srclang='id',c.src=a,c.default=!0,h.appendChild(c),i.innerText='SUB: ID'):(f=await fetch(a),f.ok&&(g=await f.text(),i=(srtToVttBlob(g),c.createElement('track'),c.kind='captions',c.label='Indonesia',c.srclang='id',c.src=i,c.default=!0,h.appendChild(c),i.innerText='SUB: ID'))}catch(a){i.innerText='SUB: ERR'}else i.innerText='NO SUB';h.play(),d.isTrusted&&window.innerWidth<1024&&toggleEpisodeDrawer()}else alert('Link video rusak')}}},g.appendChild(d)}),setTimeout(()=>{g.children[a]&&g.children[a].click()},500);const m=document.getElementById('playerModal');m.classList.remove('hidden'),setTimeout(()=>m.classList.remove('opacity-0'),300),setupIdleDetection()}function srtToVttBlob(a){var b='WEBVTT\n\n',c=a.replace(/(\d{2}:\d{2}:\d{2}),(\d{3})/g,'$1.$2');return c=c.replace(/ --> ([\d:.]+)/g,' --> $1 line:65% align:center'),b+=c,URL.createObjectURL(new Blob([b],{type:'text/vtt'}))}function renderPaginationButtons(){const a=document.getElementById('pageNumbers');document.getElementById('pagination').classList.remove('hidden'),a.innerHTML='',document.getElementById('prevBtn').disabled=1===currentPage;const b=PROVIDERS[activeProviderKey].theme;let c=Math.max(1,currentPage-1),d=c+2;for(let e=c;e<=d;e++){const c=document.createElement('button');c.innerText=e,c.className=`w-10 h-10 rounded-lg text-sm font-bold transition ${e===currentPage?`${b.tabActive} text-white`:`bg-[#1a1a1a] text-gray-400 hover:bg-[#252525] hover:text-white`}`,c.onclick=()=>changePage(e),a.appendChild(c)}const e=`px-4 py-2 rounded-lg bg-[#1a1a1a] text-white ${b.hover} disabled:opacity-50 disabled:cursor-not-allowed transition`;document.getElementById('prevBtn').className=e,document.getElementById('nextBtn').className=e}function findDramasDeep(a,b=[]){if(!a)return b;if(Array.isArray(a))return a.forEach(a=>findDramasDeep(a,b)),b;if('object'==typeof a){const c=a.shortPlayName||a.title||a.name||a.bookName,d=a.shortPlayCover||a.coverUrl||a.imgUrl||a.cover,e=a.shortPlayId||a.bookId||a.id;c&&d&&e&&b.push(a),Object.values(a).forEach(a=>{'object'==typeof a&&findDramasDeep(a,b)})}return b}function setLoading(a){const b=document.getElementById('loading'),c=document.getElementById('contentArea');a?(b.classList.remove('hidden'),c.classList.add('hidden')):(b.classList.add('hidden'),c.classList.remove('hidden'))}function closeInfoModal(){document.getElementById('infoModal').classList.add('opacity-0'),setTimeout(()=>document.getElementById('infoModal').classList.add('hidden'),300)}function closePlayer(){const a=document.getElementById('playerModal'),b=document.getElementById('mainVideo');b.pause(),b.innerHTML='',b.onended=null,clearTimeout(idleTimer),a.classList.add('opacity-0'),setTimeout(()=>a.classList.add('hidden'),300),renderHistorySection()}function getHistory(){return JSON.parse(localStorage.getItem('ns_history')||'[]')}function saveToHistory(a,b,c,d){let e=getHistory().filter(b=>b.id!==a);e.unshift({id:a,title:currentDramaData.shortPlayName,cover:currentDramaData.shortPlayCover,lastEpIndex:b,lastEpNum:c,provider:d,timestamp:Date.now()}),localStorage.setItem('ns_history',JSON.stringify(e.slice(0,20))),renderHistorySection()}function clearHistory(){confirm('Hapus riwayat?')&&(localStorage.removeItem('ns_history'),renderHistorySection())}function renderHistorySection(){const a=getHistory(),b=document.getElementById('historySection'),c=document.getElementById('historyList');0===a.length?b.classList.add('hidden'):(b.classList.remove('hidden'),c.innerHTML='',a.forEach(a=>{const d=a.provider||'netshort';c.innerHTML+=`<div class="flex-none w-32 snap-start cursor-pointer group relative" onclick="openInfo('${a.id}', '${d}')"><div class="aspect-[3/4] rounded-lg overflow-hidden relative bg-[#151515] border border-white/5"><img src="${a.cover}" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition"><div class="absolute bottom-0 left-0 right-0 h-1 bg-gray-700"><div class="h-full bg-red-600 w-2/3"></div></div></div><h4 class="text-[10px] font-bold text-gray-400 mt-1 truncate group-hover:text-white">Ep ${a.lastEpNum} ‚Ä¢ ${a.title}</h4></div>`}))}function renderGrid(a){const b=document.getElementById('contentArea');b.innerHTML='';const c=document.createElement('div');c.className='grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 sm:gap-6';const d=PROVIDERS[activeProviderKey].theme;a.forEach((a,e)=>{const f=a.shortPlayId||a.id||a.bookId,g=a.shortPlayName||a.title||a.name||a.bookName,h=a.shortPlayCover||a.coverUrl||a.cover,i=a.heatScoreShow||'HOT',j=a.labelArray||[];let k=`<span class="${d.badge} text-white text-[9px] font-bold px-1.5 py-0.5 rounded backdrop-blur-sm shadow-sm">üî• ${i}</span>`;j.some(a=>/sulih|suara|dubbing|indo|bahasa/i.test(a))||g.toLowerCase().includes('indo')||'dub'===currentTab?(k=`<span class="bg-blue-600/90 text-white text-[9px] font-bold px-1.5 py-0.5 rounded shadow-sm mb-1 block w-fit">üáÆüá© INDO</span>${k}`):!0===a.isNewLabel||'new'===currentTab&&(k=`<span class="bg-green-600/90 text-white text-[9px] font-bold px-1.5 py-0.5 rounded shadow-sm mb-1 block w-fit">NEW</span>${k}`),c.innerHTML+=`<div class="group cursor-pointer relative bg-[#151515] rounded-xl overflow-hidden shadow-lg hover:shadow-red-900/20 transition-all duration-300 hover:-translate-y-1 card-anim" style="animation-delay: ${e*30}ms" onclick="openInfo('${f}')"><div class="aspect-[3/4] overflow-hidden relative"><img src="${h}" alt="${g}" loading="lazy" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"><div class="absolute inset-0 bg-gradient-to-t from-black/90 via-transparent to-transparent opacity-80 group-hover:opacity-100"></div><div class="absolute top-2 right-2 flex flex-col items-end">${k}</div></div><div class="p-3"><h3 class="text-xs sm:text-sm font-bold text-gray-200 line-clamp-2 leading-snug group-hover:${d.text} transition-colors">${g}</h3></div></div>`}),b.appendChild(c),b.classList.remove('hidden')}function changePage(a){a<1||((currentPage=a),window.scrollTo({top:0,behavior:'smooth'}),fetchDramas(a))}function setupIdleDetection(){const a=document.getElementById('playerModal'),b=document.getElementById('mainVideo'),c=[document.getElementById('playerTopUI'),document.getElementById('playerRightUI'),document.getElementById('playerBottomUI')];function d(){c.forEach(a=>a.classList.remove('ui-hidden')),clearTimeout(idleTimer),b.paused||''===(idleTimer=setTimeout(()=>c.forEach(a=>a.classList.add('ui-hidden')),3500))}a.onmousemove=d,a.ontouchstart=e=>{e.target.closest('#episodeDrawer')||d()},a.onclick=e=>{e.target.closest('#episodeDrawer')||e.target.closest('button')||d()},b.onpause=()=>{clearTimeout(idleTimer),c.forEach(a=>a.classList.remove('ui-hidden'))},b.onplay=d}function applySiteConfig(){const a=JSON.parse(localStorage.getItem('siteConfig')||'{"name":"StreamHub123","tagline":"Nonton Drama China","desc":"Platform streaming drama pendek terlengkap.","logo":""}');document.title=`${a.name} - ${a.tagline}`;const b=document.getElementById('navSiteName'),c=document.getElementById('navLogoImg'),d=document.getElementById('navLogoBox');b&&(b.innerText=a.name),a.logo?(c&&c.src=a.logo,c&&c.classList.remove('hidden'),d&&d.classList.add('hidden')):(c&&c.classList.add('hidden'),d&&d.classList.remove('hidden'),d&&(d.innerText=a.name.charAt(0).toUpperCase())),document.getElementById('footerTitle').innerText=a.name,document.getElementById('footerDesc').innerText=a.desc,document.getElementById('copyrightName').innerText=a.name;const e=document.getElementById('footerLogoBox'),f=document.getElementById('footerLogoImg');a.logo?(f&&(f.src=a.logo),f&&f.classList.remove('hidden'),e&&e.classList.add('hidden')):(f&&f.classList.add('hidden'),e&&e.classList.remove('hidden'),e&&(e.innerText=a.name.substring(0,2).toUpperCase()))}window.addEventListener('load',()=>{loadHeaderFooter(),'dramabox'===activeProviderKey&&(loadRecommendations(),document.getElementById('vipTabBtn').classList.remove('hidden')),fetchDramas(1),renderHistorySection()});